<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Artemis Skys</title>
  <style>
    /* ===== Lunar matte theme ===== */
    :root{
      --space:#2a2a2a;           /* matte gray */
      --space-2:#1e1e1e;         /* darker matte gray */
      --card:#333333;            /* panels */
      --text:#f2f2f2;            /* high contrast text */
      --muted:#b5b5b5;           /* secondary text */
      --accent:#9a9a9a;          /* subtle accents */
      --accent-2:#c2c2c2;        /* lighter accents */
      --ok:#10b981; --warn:#f59e0b; --danger:#ef4444;
      --radius:16px; --shadow:0 14px 40px rgba(0,0,0,.35);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial; color:var(--text);
      background: linear-gradient(180deg, rgba(0,0,0,.35), rgba(0,0,0,.35)), url('https://upload.wikimedia.org/wikipedia/commons/0/02/FullMoon2010.jpg') center/cover no-repeat fixed;
      background-size: 110% auto;
    }
    .sky{position:fixed; inset:0; z-index:-1; pointer-events:none;
      background: linear-gradient(180deg, rgba(0,0,0,.35), rgba(0,0,0,.35)), url('https://upload.wikimedia.org/wikipedia/commons/0/02/FullMoon2010.jpg') center/cover no-repeat fixed;
      filter: brightness(.55);
    }

    a{color:var(--accent)}
    header{position:sticky; top:0; z-index:20; background:rgba(34,34,34,.88); backdrop-filter: blur(10px); border-bottom:1px solid rgba(255,255,255,.08)}
    .wrap{max-width:1100px; margin:0 auto; padding:16px}
    .row{display:flex; align-items:center; gap:12px}
    .spacer{flex:1}
    nav a{margin:0 10px; text-decoration:none; color:var(--text); opacity:.9}
    nav a.active{color:var(--accent-2)}

    .btn{background:linear-gradient(135deg, var(--accent), var(--accent-2)); color:#1a1a1a; border:0; padding:10px 14px; border-radius:12px; font-weight:700; box-shadow: var(--shadow); cursor:pointer; transition: transform .12s ease, box-shadow .2s ease}
    .btn:hover{transform:translateY(-1px); box-shadow: 0 0 0 2px rgba(255,255,255,.18), 0 16px 40px rgba(0,0,0,.25)}
    .btn.secondary{background:#444; color:var(--text); box-shadow:none; border:1px solid rgba(255,255,255,.12)}
    .btn.ghost{background:transparent; border:1px solid rgba(255,255,255,.15); color:var(--text)}
    .btn.small{padding:6px 10px; border-radius:10px; font-size:.9rem}

    .logo{display:flex; align-items:center; gap:10px; font-weight:800; letter-spacing:.3px}
    .logo svg{width:34px; height:34px}
    .logo span{color:var(--accent-2)}

    .hero{padding:64px 16px 24px}
    .hero h1{font-size:clamp(28px, 6vw, 48px); margin:0 0 10px; line-height:1.05; color:var(--text)}
    .hero p{max-width:720px; color:var(--muted); font-size:1.03rem}

    .cards{display:grid; grid-template-columns:repeat(auto-fit, minmax(260px,1fr)); gap:16px; margin:26px 0}
    .card{background:var(--card); border:1px solid rgba(255,255,255,.08); border-radius:var(--radius); padding:18px; box-shadow:var(--shadow)}
    .card h3{margin:0 0 6px}
    .muted{color:var(--muted)}

    .two-col{display:grid; grid-template-columns:1.2fr .8fr; gap:18px}
    @media (max-width:900px){.two-col{grid-template-columns:1fr}}

    .panel{background:var(--card); border:1px solid rgba(255,255,255,.1); border-radius:var(--radius); padding:14px; box-shadow:var(--shadow)}

    .field{display:flex; gap:10px; margin:8px 0; align-items:center}
    .field input,.field select, .field textarea{background:#222; color:var(--text); border:1px solid rgba(255,255,255,.15); border-radius:12px; padding:10px 12px; width:100%}
    .field label{min-width:120px; color:var(--muted)}
    .help{font-size:.9rem; color:var(--muted); margin-top:6px}

    table{width:100%; border-collapse:collapse; font-size:.95rem}
    th,td{border-bottom:1px solid rgba(255,255,255,.1); padding:10px; text-align:left}
    th{color:#f5f5f5; font-weight:800}
    tr:hover td{background:rgba(255,255,255,.05)}

    .tabs{display:flex; gap:8px; flex-wrap:wrap}
    .tab{padding:8px 12px; border-radius:999px; border:1px solid rgba(255,255,255,.15); cursor:pointer; background:rgba(50,50,50,.7)}
    .tab.active{border-color:transparent; background:linear-gradient(135deg, rgba(120,120,120,.45), rgba(170,170,170,.45))}

    .hidden{display:none}
    .right{justify-content:flex-end}
    .notice{font-size:.95rem; color:var(--muted)}
    .tag{border:1px solid rgba(255,255,255,.2); border-radius:999px; padding:4px 8px; font-size:.8rem; color:var(--muted); background:rgba(50,50,50,.7)}

    footer{opacity:.85; padding:44px 16px; text-align:center; color:var(--muted)}
  </style>
</head>
<body>
  <div class="sky" aria-hidden="true"></div>

  <header>
    <div class="wrap row">
      <div class="logo" id="go-home" style="cursor:pointer">
        <svg viewBox="0 0 64 64" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
          <defs><linearGradient id="g" x1="0" y1="0" x2="1" y2="1">
            <stop offset="0%" stop-color="#bbbbbb"/><stop offset="100%" stop-color="#e0e0e0"/>
          </linearGradient></defs>
          <path d="M40 10a16 16 0 1 0 14 24A18 18 0 1 1 40 10Z" fill="url(#g)"/>
          <path d="M16 44c0-5.523 4.477-10 10-10a9.98 9.98 0 0 1 7.14 2.96A12 12 0 1 1 46 52H20a8 8 0 0 1-8-8Z" fill="#e5e7eb" opacity=".9"/>
        </svg>
        <span>Artemis Skys</span>
      </div>
      <nav class="spacer">
        <a href="#home" data-nav>Home</a>
        <a href="#about" data-nav>About</a>
        <a href="#more" data-nav>More Info</a>
        <a href="#host" data-nav>For Companies</a>
      </nav>

      <!-- Shown when logged out -->
      <div class="row right" id="auth-buttons">
        <button class="btn small" id="btn-login">Log in</button>
        <button class="btn ghost small" id="btn-signup">Sign up</button>
      </div>

      <!-- Shown when logged in -->
      <div class="row right hidden" id="user-badge">
        <span class="tag" id="whoami">Signed in</span>
        <button class="btn secondary small" id="btn-logout">Log out</button>
        <button class="btn ghost small hidden" id="resend-verify">Resend verification</button>
      </div>
    </div>
  </header>

  <main class="wrap">
    <!-- LANDING -->
    <section id="home" class="hero">
      <h1>Scheduling & Inventory that feels calm and reliable.</h1>
      <p>
        Artemis Skys lets companies host team schedules and inventory data in one secure workspace.
        Sign in to unlock a lightweight <strong>Schedule Maker</strong> and a robust <strong>Inventory System</strong> — all in one file.
      </p>
      <div class="row" style="margin-top:18px; gap:12px">
        <button class="btn" id="cta-get-started">Get Started</button>
        <button class="btn secondary" id="cta-learn">Learn More</button>
      </div>

      <div class="cards">
        <div class="card"><h3>Unified Hub</h3><p class="muted">Manage shifts and stock without switching apps.</p></div>
        <div class="card"><h3>Local Storage</h3><p class="muted">Use localStorage now; hook up a DB later.</p></div>
        <div class="card"><h3>Simple Deploy</h3><p class="muted">Drop this HTML on any static host and you're live.</p></div>
      </div>
    </section>

    <section id="about" class="hero hidden">
      <h1>About Artemis Skys</h1>
      <p>A compact operations portal for small teams focused on <strong>shifts</strong> and <strong>stock</strong>.</p>
      <div class="two-col" style="margin-top:10px">
        <div class="panel">
          <h3>Key Features</h3>
          <ul>
            <li>Employee schedule maker with week view</li>
            <li>Shift templates & quick assign</li>
            <li>Inventory add/receive/issue with audit log</li>
            <li>CSV/JSON export and import</li>
          </ul>
        </div>
        <div class="panel">
          <h3>Tech Notes</h3>
          <ul>
            <li>Pure HTML/CSS/JS</li>
            <li>LocalStorage for persistence</li>
            <li>Easily swap auth for your backend</li>
          </ul>
        </div>
      </div>
    </section>

    <section id="more" class="hero hidden">
      <h1>More Info</h1>
      <div class="cards">
        <div class="card"><h3>Data Portability</h3><p class="muted">Export everything as JSON.</p></div>
        <div class="card"><h3>Privacy</h3><p class="muted">Data stays in your browser unless you export.</p></div>
        <div class="card"><h3>Extensibility</h3><p class="muted">Add roles, notifications, reporting.</p></div>
      </div>
    </section>

    <section id="host" class="hero hidden">
      <h1>For Companies</h1>
      <p class="muted">Create an account or log in to start building schedules and tracking inventory.</p>
      <div class="panel">
        <strong>Quick Start</strong>
        <ol>
          <li>Click <em>Sign up</em> to create your admin user.</li>
          <li>Add employees in the Schedule tab after login.</li>
          <li>Seed your inventory with items and quantities.</li>
          <li>Export JSON regularly for backups.</li>
        </ol>
      </div>
    </section>

    <!-- AUTH -->
    <section id="auth" class="hero hidden">
      <div class="two-col">
        <div class="panel">
          <h3>Log in</h3>
          <div class="field"><label>Email</label><input id="login-email" type="email" placeholder="you@company.com"/></div>
          <div class="field"><label>Password</label><input id="login-pass" type="password" placeholder="••••••••"/></div>
          <div class="row right" style="gap:8px">
            <button class="btn secondary" id="forgot-pass">Forgot password</button>
            <button class="btn" id="do-login">Enter</button>
          </div>
          <p class="help">You must verify your email before you can use the app.</p>
        </div>
        <div class="panel">
          <h3>Sign up</h3>
          <div class="field"><label>Name</label><input id="su-name" type="text" placeholder="Full name"/></div>
          <div class="field"><label>Email</label><input id="su-email" type="email" placeholder="you@company.com"/></div>
          <div class="field"><label>Password</label><input id="su-pass" type="password" placeholder="At least 6 chars"/></div>
          <div class="row right"><button class="btn secondary" id="do-signup">Create Account</button></div>
          <p class="help">After sign up, check your inbox and verify your email.</p>
        </div>
      </div>
    </section>

    <!-- APP -->
    <section id="app" class="hero hidden">
      <div class="row" style="margin-bottom:12px">
        <div class="tabs" id="app-tabs">
          <div class="tab active" data-tab="schedule">Schedule</div>
          <div class="tab" data-tab="inventory">Inventory</div>
          <div class="tab" data-tab="data">Data</div>
        </div>
        <div class="spacer"></div>
        <div class="tag" id="session-user">User</div>
      </div>

      <!-- SCHEDULE -->
      <div id="tab-schedule">
        <div class="two-col">
          <div class="panel">
            <h3>Employees</h3>
            <div class="field"><input id="emp-name" placeholder="Employee name"/><button class="btn small" id="add-emp">Add</button></div>
            <table id="emp-table">
              <thead><tr><th>Name</th><th>Action</th></tr></thead>
              <tbody></tbody>
            </table>
          </div>
          <div class="panel">
            <h3>New Shift</h3>
            <div class="field"><label>Date</label><input id="shift-date" type="date"/></div>
            <div class="field"><label>Employee</label><select id="shift-emp"></select></div>
            <div class="field"><label>Start</label><input id="shift-start" type="time"/></div>
            <div class="field"><label>End</label><input id="shift-end" type="time"/></div>
            <div class="row right"><button class="btn" id="add-shift">Add Shift</button></div>
          </div>
        </div>
        <div class="panel" style="margin-top:16px">
          <div class="row" style="gap:8px; align-items:center">
            <h3 style="margin:0">Week View</h3>
            <div class="spacer"></div>
            <input id="week-start" type="date"/>
            <button class="btn small" id="refresh-week">Refresh</button>
          </div>
          <div style="overflow:auto; margin-top:10px">
            <table id="week-table">
              <thead id="week-head"></thead>
              <tbody id="week-body"></tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- INVENTORY -->
      <div id="tab-inventory" class="hidden">
        <div class="two-col">
          <div class="panel">
            <h3>Add / Edit Item</h3>
            <div class="field"><label>Name</label><input id="inv-name" placeholder="Item name"/></div>
            <div class="field"><label>SKU</label><input id="inv-sku" placeholder="SKU-123"/></div>
            <div class="field"><label>Qty</label><input id="inv-qty" type="number" placeholder="0"/></div>
            <div class="field"><label>Unit Cost</label><input id="inv-cost" type="number" step="0.01" placeholder="0.00"/></div>
            <div class="row right"><button class="btn" id="save-item">Save Item</button></div>
          </div>
          <div class="panel">
            <h3>Adjust Stock</h3>
            <div class="field"><label>SKU</label><input id="adj-sku" placeholder="SKU-123"/></div>
            <div class="field"><label>Change</label><input id="adj-delta" type="number" placeholder="e.g. +5 or -2"/></div>
            <div class="row right" style="gap:8px">
              <button class="btn small" id="receive">Receive (+)</button>
              <button class="btn secondary small" id="issue">Issue (-)</button>
            </div>
          </div>
        </div>
        <div class="panel" style="margin-top:16px">
          <div class="row" style="gap:8px; align-items:center">
            <h3 style="margin:0">Inventory</h3>
            <div class="spacer"></div>
            <button class="btn ghost small" id="export-inv">Export CSV</button>
          </div>
          <div style="overflow:auto; margin-top:10px">
            <table id="inv-table">
              <thead><tr><th>Name</th><th>SKU</th><th>Qty</th><th>Unit Cost</th><th>Value</th><th>Actions</th></tr></thead>
              <tbody></tbody>
            </table>
          </div>
        </div>
        <div class="panel" style="margin-top:16px">
          <h3>Audit Log</h3>
          <table id="log-table">
            <thead><tr><th>When</th><th>SKU</th><th>Delta</th><th>Note</th></tr></thead>
            <tbody></tbody>
          </table>
        </div>
      </div>

      <!-- DATA -->
      <div id="tab-data" class="hidden">
        <div class="two-col">
          <div class="panel">
            <h3>Export / Import</h3>
            <div class="row" style="gap:8px; flex-wrap:wrap">
              <button class="btn small" id="export-json">Export JSON</button>
              <label class="btn ghost small" style="cursor:pointer">
                Import JSON
                <input id="import-json" type="file" accept="application/json" style="display:none"/>
              </label>
            </div>
            <p class="notice">Includes users (hashed), schedule, inventory, and logs.</p>
          </div>
          <div class="panel">
            <h3>Danger Zone</h3>
            <button class="btn" style="background:linear-gradient(135deg, var(--danger), #b91c1c)" id="wipe">Wipe Local Data</button>
            <p class="notice">Clears all Artemis Skys data from this browser.</p>
          </div>
        </div>
      </div>
    </section>
  </main>

  <footer>© <span id="year"></span> Artemis Skys. All rights reserved.</footer>

  <!-- ========= App utilities and non-auth logic ========= -->
  <script>
    // Utilities
    const $ = sel => document.querySelector(sel);
    const $$ = sel => [...document.querySelectorAll(sel)];
    const fmtDate = d => new Date(d).toLocaleString([], {year:'numeric', month:'short', day:'2-digit', hour:'2-digit', minute:'2-digit'});
    const weekStartISO = () => {
      const d = new Date();
      const day = d.getDay(); // 0 Sun
      const diff = d.getDate() - day + (day === 0 ? -6 : 1); // Monday as start
      const monday = new Date(d.setDate(diff));
      return monday.toISOString().slice(0,10);
    };
    const store = {
      get(k, fallback){ try{ return JSON.parse(localStorage.getItem(k) ?? JSON.stringify(fallback)); }catch{ return fallback } },
      set(k, v){ localStorage.setItem(k, JSON.stringify(v)); }
    };
    const K = { employees: 'as_emps', shifts: 'as_shifts', inv: 'as_inv', log: 'as_inv_log' };

    // Section nav
    function showSection(id){
      ['home','about','more','host','auth','app'].forEach(s=>{
        const el = document.getElementById(s);
        if(!el) return; el.classList.toggle('hidden', s!==id);
      });
      $$('nav a[data-nav]').forEach(a=>{
        const tgt = a.getAttribute('href').replace('#','');
        a.classList.toggle('active', tgt===id);
      })
    }
    window.showSection = showSection;

    // Landing buttons
    $('#go-home').onclick = ()=>showSection('home');
    $('#cta-learn').onclick = ()=>showSection('about');
    $('#cta-get-started').onclick = ()=>showSection('host');
    $$('a[data-nav]').forEach(a=>a.onclick = (e)=>{ e.preventDefault(); showSection(a.getAttribute('href').substring(1)) });

    // App tabs
    $$('#app-tabs .tab').forEach(t=>t.onclick = ()=>{
      $$('#app-tabs .tab').forEach(x=>x.classList.remove('active'));
      t.classList.add('active');
      ['schedule','inventory','data'].forEach(id=>{
        const on = t.dataset.tab===id;
        $('#tab-'+id).classList.toggle('hidden', !on);
      });
    });

    // Employees
    function refreshEmp(){
      const emps = store.get(K.employees, []);
      const tbody = $('#emp-table tbody');
      tbody.innerHTML = '';
      emps.forEach((e, i)=>{
        const tr = document.createElement('tr');
        tr.innerHTML = `<td>${e}</td><td><button class="btn ghost small" data-del-emp="${i}">Remove</button></td>`;
        tbody.appendChild(tr);
      });
      tbody.querySelectorAll('[data-del-emp]').forEach(btn=>{
        btn.onclick = ()=>{
          const idx = +btn.dataset.delEmp; const list = store.get(K.employees, []);
          list.splice(idx,1); store.set(K.employees, list); refreshEmp(); refreshShiftOptions(); refreshWeek();
        };
      });
    }
    $('#add-emp').onclick = ()=>{
      const name = $('#emp-name').value.trim();
      if(!name) return;
      const list = store.get(K.employees, []);
      list.push(name); store.set(K.employees, list);
      $('#emp-name').value=''; refreshEmp(); refreshShiftOptions(); refreshWeek();
    };

    function refreshShiftOptions(){
      const sel = $('#shift-emp'); sel.innerHTML='';
      store.get(K.employees, []).forEach(n=>{
        const o=document.createElement('option'); o.value=n; o.textContent=n; sel.appendChild(o);
      });
    }

    // Shifts
    $('#add-shift').onclick = ()=>{
      const date=$('#shift-date').value || new Date().toISOString().slice(0,10);
      const emp=$('#shift-emp').value; const start=$('#shift-start').value; const end=$('#shift-end').value;
      if(!emp||!start||!end) return alert('Pick employee, start and end time.');
      const shifts=store.get(K.shifts, []); shifts.push({date,emp,start,end}); store.set(K.shifts, shifts);
      refreshWeek(); alert('Shift added.');
    };
    $('#refresh-week').onclick = refreshWeek;
    $('#week-start').value = weekStartISO();

    function refreshWeek(){
      const start = new Date($('#week-start').value || weekStartISO());
      const days = [...Array(7)].map((_,i)=>{ const d=new Date(start); d.setDate(d.getDate()+i); return d; });
      const head = $('#week-head'); head.innerHTML=''; const htr = document.createElement('tr');
      htr.innerHTML = '<th>Employee</th>' + days.map(d=>`<th>${d.toLocaleDateString([], {weekday:'short', month:'short', day:'numeric'})}</th>`).join('');
      head.appendChild(htr);

      const body = $('#week-body'); body.innerHTML='';
      const emps = store.get(K.employees, []); const shifts = store.get(K.shifts, []);
      emps.forEach(emp=>{
        const tr = document.createElement('tr');
        const tds = days.map(d=>{
          const iso = d.toISOString().slice(0,10);
          const list = shifts.filter(s=>s.emp===emp && s.date===iso);
          return `<td>${list.map(s=>`${s.start}–${s.end}`).join('<br>')}</td>`;
        });
        tr.innerHTML = `<td><strong>${emp}</strong></td>` + tds.join('');
        body.appendChild(tr);
      });
    }

    // Inventory
    function refreshInv(){
      const inv = store.get(K.inv, []);
      const tbody = $('#inv-table tbody'); tbody.innerHTML='';
      inv.forEach((it, i)=>{
        const val = (it.qty||0) * (it.cost||0);
        const tr = document.createElement('tr');
        tr.innerHTML = `<td>${it.name}</td><td>${it.sku}</td><td>${it.qty}</td><td>${(it.cost??0).toFixed(2)}</td><td>${val.toFixed(2)}</td>
        <td><button class="btn ghost small" data-edit="${i}">Edit</button>
            <button class="btn secondary small" data-del="${i}">Delete</button></td>`;
        tbody.appendChild(tr);
      });
      tbody.querySelectorAll('[data-del]').forEach(btn=>{
        btn.onclick = ()=>{ const inv=store.get(K.inv, []); inv.splice(+btn.dataset.del,1); store.set(K.inv, inv); refreshInv(); };
      });
      tbody.querySelectorAll('[data-edit]').forEach(btn=>{
        btn.onclick = ()=>{ const it=store.get(K.inv, [])[+btn.dataset.edit];
          $('#inv-name').value=it.name; $('#inv-sku').value=it.sku; $('#inv-qty').value=it.qty; $('#inv-cost').value=it.cost; };
      });
    }
    function logLine(sku, delta, note=''){ const log = store.get(K.log, []); log.unshift({ts:Date.now(), sku, delta, note}); store.set(K.log, log); refreshLog(); }
    function refreshLog(){
      const tbody = $('#log-table tbody'); tbody.innerHTML='';
      store.get(K.log, []).forEach(row=>{
        const tr=document.createElement('tr');
        tr.innerHTML = `<td>${fmtDate(row.ts)}</td><td>${row.sku}</td><td>${row.delta>0?`+${row.delta}`:row.delta}</td><td>${row.note||''}</td>`;
        tbody.appendChild(tr);
      });
    }
    $('#save-item').onclick = ()=>{
      const name=$('#inv-name').value.trim(); const sku=$('#inv-sku').value.trim();
      const qty=+($('#inv-qty').value||0); const cost=parseFloat($('#inv-cost').value||'0');
      if(!name||!sku) return alert('Name and SKU required.');
      const inv=store.get(K.inv, []); const i=inv.findIndex(x=>x.sku===sku);
      if(i>=0){ inv[i]={...inv[i], name, qty, cost}; } else { inv.push({name, sku, qty, cost}); }
      store.set(K.inv, inv); logLine(sku, 0, 'Saved item');
      $('#inv-name').value=$('#inv-sku').value=$('#inv-qty').value=$('#inv-cost').value=''; refreshInv();
    };
    function adjust(sgn){
      const sku=$('#adj-sku').value.trim(); const delta= Math.abs(+($('#adj-delta').value||0))*sgn;
      if(!sku || !delta) return alert('Enter SKU and change amount.');
      const inv=store.get(K.inv, []); const i = inv.findIndex(x=>x.sku===sku);
      if(i<0) return alert('SKU not found.');
      inv[i].qty = (inv[i].qty||0) + delta; store.set(K.inv, inv);
      logLine(sku, delta, sgn>0? 'Receive' : 'Issue'); refreshInv();
    }
    $('#receive').onclick = ()=>adjust(+1);
    $('#issue').onclick = ()=>adjust(-1);

    // Data import/export
    $('#export-json').onclick = ()=>{
      const blob = new Blob([JSON.stringify({
        employees: store.get(K.employees, []),
        shifts: store.get(K.shifts, []),
        inv: store.get(K.inv, []),
        log: store.get(K.log, [])
      }, null, 2)], {type:'application/json'});
      const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download='artemis-skys-data.json'; a.click();
    };
    $('#import-json').onchange = (e)=>{
      const file = e.target.files[0]; if(!file) return;
      const r = new FileReader(); r.onload = ()=>{
        try{
          const data = JSON.parse(r.result);
          if(data.employees) store.set(K.employees, data.employees);
          if(data.shifts) store.set(K.shifts, data.shifts);
          if(data.inv) store.set(K.inv, data.inv);
          if(data.log) store.set(K.log, data.log);
          alert('Data imported.');
          refreshEmp(); refreshShiftOptions(); refreshWeek(); refreshInv(); refreshLog();
        }catch(err){ alert('Invalid JSON.'); }
      }; r.readAsText(file);
    };

    $('#export-inv').onclick = ()=>{
      const rows = [['Name','SKU','Qty','Unit Cost','Value']];
      store.get(K.inv, []).forEach(it=> rows.push([it.name, it.sku, it.qty, (it.cost??0).toFixed(2), ((it.qty||0)*(it.cost||0)).toFixed(2)]));
      const csv = rows.map(r=>r.map(x=>`"${String(x).replaceAll('"','""')}"`).join(',')).join('\n');
      const blob = new Blob([csv], {type:'text/csv'});
      const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download='inventory.csv'; a.click();
    };

    $('#wipe').onclick = ()=>{
      if(!confirm('Wipe all Artemis Skys data from this browser?')) return;
      [K.employees,K.shifts,K.inv,K.log].forEach(k=>localStorage.removeItem(k));
      location.reload();
    };

    document.getElementById('year').textContent = new Date().getFullYear();
    refreshEmp(); refreshShiftOptions(); refreshWeek(); refreshInv(); refreshLog();
    showSection('home');
  </script>

  <!-- ========= Firebase (Auth + verification + forgot) ========= -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-app.js";
    import {
      getAuth,
      onAuthStateChanged,
      createUserWithEmailAndPassword,
      signInWithEmailAndPassword,
      sendEmailVerification,
      sendPasswordResetEmail,
      applyActionCode,
      signOut
    } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-auth.js";
    import { getAnalytics } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-analytics.js";

    // ---- Your Firebase config ----
    const firebaseConfig = {
      apiKey: "AIzaSyA1kAD-jLJ7UqoTNoDQomI-NhXqusey2Mk",
      authDomain: "artemisskys-81c8d.firebaseapp.com",
      projectId: "artemisskys-81c8d",
      storageBucket: "artemisskys-81c8d.firebasestorage.app",
      messagingSenderId: "1048827230936",
      appId: "1:1048827230936:web:b0e70cce57c867a23635ad",
      measurementId: "G-DY343FNTFS"
    };

    const app = initializeApp(firebaseConfig);
    try { getAnalytics(app); } catch {} // analytics optional
    const auth = getAuth(app);

    // Buttons / inputs
    const btnLogin = document.getElementById('btn-login');
    const btnSignup = document.getElementById('btn-signup');
    const doLogin  = document.getElementById('do-login');
    const doSignup = document.getElementById('do-signup');
    const btnLogout = document.getElementById('btn-logout');
    const forgotBtn = document.getElementById('forgot-pass');
    const resendBtn = document.getElementById('resend-verify');

    // UI toggle based on auth state
    function refreshAuthUI(){
      const user = auth.currentUser;
      const authed = !!user && !!user.email;
      document.getElementById('auth-buttons').classList.toggle('hidden', authed);
      document.getElementById('user-badge').classList.toggle('hidden', !authed);
      if (authed) {
        const verified = user.emailVerified;
        document.getElementById('whoami').textContent = user.email + (verified ? '' : ' (unverified)');
        document.getElementById('session-user').textContent = user.email;
        resendBtn.classList.toggle('hidden', verified); // show resend when NOT verified
        if (verified) {
          window.showSection('app');
        } else {
          // keep them in auth page to prompt verification
          window.showSection('auth');
        }
      } else {
        window.showSection('home');
      }
    }
    window.refreshAuthUI = refreshAuthUI;

    // Clicks to show auth section
    btnLogin.onclick = ()=>{ window.showSection('auth'); document.getElementById('login-email').focus(); };
    btnSignup.onclick = ()=>{ window.showSection('auth'); document.getElementById('su-name').focus(); };

    // Sign up + verification
    doSignup.onclick = async () => {
      const name = document.getElementById('su-name').value.trim();
      const email = document.getElementById('su-email').value.trim();
      const pass  = document.getElementById('su-pass').value;
      if(!name || !email || pass.length < 6){ alert('Please fill all fields (password ≥ 6).'); return; }
      try{
        const { user } = await createUserWithEmailAndPassword(auth, email, pass);
        await sendEmailVerification(user, { url: "https://artemisskys.com/" });
        alert('Account created. Check your email for a verification link.');
      }catch(e){
        console.error(e);
        alert((e && e.message) || 'Sign up failed');
      }
    };

    // Login (requires verified email)
    doLogin.onclick = async () => {
      const email = document.getElementById('login-email').value.trim();
      const pass  = document.getElementById('login-pass').value;
      try{
        const { user } = await signInWithEmailAndPassword(auth, email, pass);
        if(!user.emailVerified){
          alert('Please verify your email first. We sent you a link when you signed up.');
        }
        refreshAuthUI();
      }catch(e){
        console.error(e);
        alert((e && e.message) || 'Login failed');
      }
    };

    // Forgot password
    forgotBtn.onclick = async () => {
      const email = document.getElementById('login-email').value.trim();
      if(!email) return alert('Enter your email first.');
      try{
        await sendPasswordResetEmail(auth, email, { url: "https://artemisskys.com/" });
        alert('Password reset email sent. Check your inbox.');
      }catch(e){
        console.error(e);
        alert((e && e.message) || 'Failed to send reset email.');
      }
    };

    // Resend verification
    resendBtn.onclick = async () => {
      const user = auth.currentUser;
      if(!user) return alert('Please log in first.');
      try{
        await sendEmailVerification(user, { url: "https://artemisskys.com/" });
        alert('Verification email sent. Check your inbox (and Spam).');
      }catch(e){
        console.error(e);
        alert((e && e.message) || 'Failed to send verification email.');
      }
    };

    // Logout
    btnLogout.onclick = async ()=>{
      await signOut(auth);
      refreshAuthUI();
      window.showSection('home');
    };

    // Handle email-verification links (?mode=verifyEmail&oobCode=...)
    (async () => {
      const params = new URLSearchParams(location.search);
      const mode = params.get('mode');
      const oobCode = params.get('oobCode');
      if (mode === 'verifyEmail' && oobCode) {
        try {
          await applyActionCode(auth, oobCode);
          alert('Email verified! You can now log in.');
          history.replaceState({}, '', location.pathname); // strip params
          refreshAuthUI();
        } catch (e) {
          console.error('verifyEmail failed', e);
          alert('This verification link is invalid or expired. Please log in and click "Resend verification".');
          history.replaceState({}, '', location.pathname);
        }
      }
    })();

    // React to auth changes
    onAuthStateChanged(auth, ()=>{
      refreshAuthUI();
    });
  </script>
</body>
</html>
